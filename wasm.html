<html>
<head>
	<title>Tutara WASM Test</title>
</head>
<body>
	<form method="post" id="form">
		<textarea id="input"></textarea>

		<button type="submit">Run</button>
	</form>
	<pre id="result">Press run</pre>

	<script type="module">
		import init, { get_tokens } from './wasm/pkg/tutara_wasm.js';

		let isInit = false;

		async function run_code() {
			if (!isInit) {
				await init();
				isInit = true;
			}

			const input = document.querySelector('#input').value;
			localStorage.setItem('ttr-input', input);
			const tokens = get_tokens(input).tokens;

			// Needed for JSON.stringify function
			const localTokens = tokens.map(({ token_type, literal, line, column, length }) => ({ token_type, literal, line, column, length }));

			document.querySelector('#result').textContent = JSON.stringify(localTokens, null, '    ');
		}

		if (localStorage['ttr-input']) {
			document.querySelector('#input').value = localStorage['ttr-input'];
		}

		document.querySelector('#form').addEventListener('submit', event => {
			event.preventDefault();
			run_code();
		});
	</script>
</body>
</html>